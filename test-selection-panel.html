<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Selection Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/selection-panel.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">ðŸ§ª Test - Selection Panel Component</h1>

                <div id="app">
                    <selection-panel :selected-items="selectedItems" :only-open-sections="onlyOpenSections"
                        :selected-campus="selectedCampus" :campuses="campuses"
                        :generating-schedules="generatingSchedules" @toggle-selection-type="onToggleSelectionType"
                        @remove-item="onRemoveItem" @bulk-change-type="onBulkChangeType" @clear-all="onClearAll"
                        @generate-schedules="onGenerateSchedules" @update:onlyOpenSections="onlyOpenSections = $event"
                        @update:selectedCampus="selectedCampus = $event" />

                    <!-- Debug Panel -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="m-0">ðŸ”§ Debug Panel</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Add Test Items:</h6>
                                    <button @click="addTestSubject" class="btn btn-sm btn-primary me-2">Add
                                        Subject</button>
                                    <button @click="addTestSection" class="btn btn-sm btn-secondary me-2">Add
                                        Section</button>
                                    <button @click="addConflictingItems" class="btn btn-sm btn-warning">Add
                                        Conflicts</button>
                                </div>
                                <div class="col-md-6">
                                    <h6>Controls:</h6>
                                    <button @click="toggleGenerating" class="btn btn-sm btn-info me-2">
                                        {{ generatingSchedules ? 'Stop' : 'Start' }} Generating
                                    </button>
                                    <button @click="clearAll" class="btn btn-sm btn-danger">Clear All</button>
                                </div>
                            </div>

                            <div class="mt-3">
                                <h6>Current State:</h6>
                                <pre class="bg-light p-2 rounded small">{{ JSON.stringify({
                                    totalItems: selectedItems.length,
                                    priorityItems: selectedItems.filter(i => i.selectionType === 'priority').length,
                                    candidateItems: selectedItems.filter(i => i.selectionType === 'candidate').length,
                                    onlyOpenSections,
                                    selectedCampus,
                                    generatingSchedules
                                }, null, 2) }}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import SelectionPanel from './js/components/SelectionPanel.js';

        const { createApp } = Vue;

        createApp({
            components: {
                SelectionPanel
            },

            data() {
                return {
                    selectedItems: [],
                    onlyOpenSections: true,
                    selectedCampus: '',
                    campuses: ['Caracas', 'Guayana', 'Valencia'],
                    generatingSchedules: false,
                    itemCounter: 1
                };
            },

            mounted() {
                // Add some initial test data
                this.addTestSubject();
                this.addTestSection();
            },

            methods: {
                addTestSubject() {
                    const subject = {
                        id: `subject-${this.itemCounter}`,
                        subject: 'MAT',
                        courseNumber: `${1000 + this.itemCounter}`,
                        courseTitle: `MatemÃ¡tica ${this.itemCounter}`,
                        creditHourLow: 3,
                        sections: [
                            {
                                id: `section-${this.itemCounter}-1`,
                                courseReferenceNumber: `${10000 + this.itemCounter}`,
                                sequenceNumber: '01',
                                openSection: true,
                                meetingsFaculty: [{
                                    meetingTime: {
                                        monday: true,
                                        wednesday: true,
                                        friday: true,
                                        beginTime: '08:00',
                                        endTime: '09:30'
                                    }
                                }]
                            },
                            {
                                id: `section-${this.itemCounter}-2`,
                                courseReferenceNumber: `${10000 + this.itemCounter + 1}`,
                                sequenceNumber: '02',
                                openSection: false,
                                meetingsFaculty: [{
                                    meetingTime: {
                                        tuesday: true,
                                        thursday: true,
                                        beginTime: '10:00',
                                        endTime: '11:30'
                                    }
                                }]
                            }
                        ]
                    };

                    this.selectedItems.push({
                        type: 'subject',
                        item: subject,
                        selectionType: Math.random() > 0.5 ? 'priority' : 'candidate'
                    });

                    this.itemCounter++;
                },

                addTestSection() {
                    const section = {
                        id: `section-${this.itemCounter}`,
                        courseReferenceNumber: `${20000 + this.itemCounter}`,
                        sequenceNumber: '01',
                        openSection: Math.random() > 0.3,
                        meetingsFaculty: [{
                            meetingTime: {
                                monday: true,
                                wednesday: true,
                                beginTime: '14:00',
                                endTime: '15:30'
                            }
                        }]
                    };

                    this.selectedItems.push({
                        type: 'section',
                        item: section,
                        selectionType: Math.random() > 0.5 ? 'priority' : 'candidate',
                        subjectInfo: {
                            id: `subject-info-${this.itemCounter}`,
                            subject: 'FIS',
                            courseNumber: `${2000 + this.itemCounter}`,
                            courseTitle: `FÃ­sica ${this.itemCounter}`,
                            creditHourLow: 4
                        }
                    });

                    this.itemCounter++;
                },

                addConflictingItems() {
                    // Add two sections with conflicting schedules
                    const conflictTime = {
                        monday: true,
                        wednesday: true,
                        beginTime: '08:00',
                        endTime: '09:30'
                    };

                    for (let i = 0; i < 2; i++) {
                        const section = {
                            id: `conflict-section-${this.itemCounter + i}`,
                            courseReferenceNumber: `${30000 + this.itemCounter + i}`,
                            sequenceNumber: '01',
                            openSection: true,
                            meetingsFaculty: [{
                                meetingTime: conflictTime
                            }]
                        };

                        this.selectedItems.push({
                            type: 'section',
                            item: section,
                            selectionType: 'priority',
                            subjectInfo: {
                                id: `conflict-subject-${this.itemCounter + i}`,
                                subject: 'CON',
                                courseNumber: `${3000 + this.itemCounter + i}`,
                                courseTitle: `Conflicto ${this.itemCounter + i}`,
                                creditHourLow: 3
                            }
                        });
                    }

                    this.itemCounter += 2;
                },

                onToggleSelectionType(item) {
                    item.selectionType = item.selectionType === 'priority' ? 'candidate' : 'priority';
                    console.log('Toggle selection type:', item);
                },

                onRemoveItem(item) {
                    const index = this.selectedItems.indexOf(item);
                    if (index > -1) {
                        this.selectedItems.splice(index, 1);
                    }
                    console.log('Remove item:', item);
                },

                onBulkChangeType(items, newType) {
                    items.forEach(item => {
                        item.selectionType = newType;
                    });
                    console.log('Bulk change type:', items.length, 'items to', newType);
                },

                onClearAll() {
                    this.selectedItems = [];
                    console.log('Clear all items');
                },

                onGenerateSchedules() {
                    console.log('Generate schedules with:', this.selectedItems.length, 'items');
                    this.generatingSchedules = true;
                    setTimeout(() => {
                        this.generatingSchedules = false;
                        console.log('Schedule generation completed');
                    }, 3000);
                },

                toggleGenerating() {
                    this.generatingSchedules = !this.generatingSchedules;
                },

                clearAll() {
                    this.selectedItems = [];
                }
            }
        }).mount('#app');
    </script>
</body>

</html>